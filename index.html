<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Daily Hisab</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial;
  background:#faf9f7;
  margin:0;
  color:#222;
}

/* ================= HEADER ================= */

.header{
  padding:24px 20px 10px;
  max-width:900px;
  margin:auto;
}

.header-top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:20px;
}

.header h1{
  font-size:34px;
  color:#e45d3c;
  margin:0;
}

.sub{
  color:#777;
  margin-top:6px;
  font-size:14px;
}

/* Right Side */
.header-actions{
  display:flex;
  align-items:center;
  gap:15px;
}

/* Diesel Box */
#lastDieselBox{
  background:#1e4fa3;
  color:#fff;
  padding:10px 18px;
  border-radius:30px;
  font-weight:600;
  font-size:14px;
  white-space:nowrap;
}

/* History Button */
.history-btn{
  background:#144d3d;
  color:#fff;
  border:none;
  padding:10px 20px;
  border-radius:25px;
  font-weight:600;
  cursor:pointer;
  transition:0.2s;
}

.history-btn:hover{
  background:#0f3c30;
}

/* ================= MOBILE ================= */

@media(max-width:768px){

  .header-top{
    flex-direction:column;
    align-items:flex-start;
  }

  .header-actions{
    width:100%;
    justify-content:space-between;
  }

  #lastDieselBox{
    flex:1;
    text-align:center;
  }

}


/* CARD */
.container{
  max-width:900px;
  margin:18px auto;
  background:#fff;
  padding:20px;
  border-radius:16px;
  box-shadow:0 6px 18px rgba(0,0,0,0.06);
}

.section{
  font-weight:bold;
  margin:18px 0 12px;
}

.row{
  display:grid;
  grid-template-columns:1.2fr 1fr 1fr;
  gap:12px;
  margin-bottom:10px;
}
.row label{font-weight:normal}

input{
  padding:12px;
  border-radius:10px;
  border:1px solid #e5e5e5;
  font-size:15px;
}

.total{
  font-weight:bold;
  margin-top:12px;
}

/* WEEKLY INFO */
.info{
  background:#f4f9f6;
}

/* BUTTON */
/* STICKY SAVE BUTTON ‚Äì FIXED */
.sticky-save{
  position:sticky;
  bottom:0;
  background:#faf9f7;
  padding:16px 20px;
  display:flex;
  justify-content:center;
  z-index:100;
}

.sticky-save button{
  width:100%;
  max-width:900px;
    background:#144d3d;
  color:#fff;
  border:none;
  padding:18px;
  border-radius:16px;
  font-size:18px;
  font-weight:700;
  cursor:pointer;
}

.date-box{
  text-align:center;
}

.date-box input{
  padding:14px 18px;
  border-radius:12px;
  border:1px solid #ddd;
  font-size:16px;
}

  /* =========================
   MOBILE RESPONSIVE FIX
   ========================= */
@media (max-width: 768px){

  body{
    font-size:14px;
  }

  .header{
    font-size:26px;
    padding:18px 16px 8px;
  }

  .container{
    margin:12px;
    padding:16px;
    border-radius:14px;
  }

  /* rows (Item / Cash / Online) -> stack */
  .row{
    grid-template-columns:1fr;
    gap:6px;
  }

  .row label{
    font-weight:600;
    margin-top:8px;
  }

  /* inputs full width */
  input{
    width:100%;
    box-sizing:border-box;
  }

  /* Production & Sell inputs spacing */
  input + input{
    margin-top:8px;
  }

  /* totals spacing */
  .total{
    margin-top:14px;
    font-size:15px;
  }

  /* Weekly info text wrap */
  #weeklyInfo{
    line-height:1.6;
    display:block;
  }

  /* Sticky save button mobile */
  .sticky-save{
    padding:12px;
  }

  .sticky-save button{
    padding:16px;
    font-size:16px;
    border-radius:14px;
  }
}

 



</style>
</head>

<body>

  <div class="header">

  <div class="header-top">
    <div>
      <h1>Daily Hisab</h1>
      <div class="sub">Business profit kab hoga</div>
    </div>

    <div class="header-actions">
      <div id="lastDieselBox">
        ‚õΩ Last Diesel: Loading...
      </div>

      <button onclick="goToHistory()" class="history-btn">
        ‚è± History
      </button>
    </div>
  </div>

</div>


<!-- LAST SAVED INFO -->
<div class="container info">
  <div class="section">Last Update</div>
  <div id="lastSavedInfo">No data saved yet</div>
</div>

<!-- PREVIOUS SAVING -->
<div class="container">
  <div class="section">Previous Saving</div>
  Cash ‚Çπ <input id="prevCashInput" readonly>
  Online ‚Çπ <input id="prevOnlineInput" readonly>
  <p class="total">Total ‚Çπ <span id="prevTotal">0</span></p>
</div>

<!-- WEEKLY INFO -->
<div class="container info">
  <div class="section">Weekly Info</div>
  <span id="weeklyInfo">‚Äì</span>
</div>

<!-- DATE -->
<div class="container">
  <div class="section">Date</div>
  <div class="date-box">
    <input type="date" id="date">
  </div>
</div>

<!-- INVESTMENT -->
<div class="container">
  <div class="section">---- Investment (Cash / Online) ----</div>

  <div class="row"><label>Item</label><label>Cash</label><label>Online</label></div>

  <div class="row"><label>Chicken</label><input class="invCash" placeholder="Cash " id="ChickenCash"><input class="invOnline" placeholder="Online " id="ChickenOnline"></div>
  <div class="row"><label>Dairy</label><input class="invCash" placeholder="Cash " id="DairyCash"><input class="invOnline" placeholder="Online " id="DairyOnline"></div>
  <div class="row"><label>Grocery</label><input class="invCash" placeholder="Cash " id="GroceryCash"><input class="invOnline" placeholder="Online " id="GroceryOnline"></div>
  <div class="row"><label>Sabji</label><input class="invCash" placeholder="Cash " id="SabjiCash"><input class="invOnline" placeholder="Online " id="SabjiOnline"></div>
  <div class="row"><label>Disposal</label><input class="invCash" placeholder="Cash " id="DisposalCash"><input class="invOnline" placeholder="Online " id="DisposalOnline"></div>
  <div class="row"><label>Gas</label><input class="invCash" placeholder="Cash " id="GasCash"><input class="invOnline" placeholder="Online " id="GasOnline"></div>
  <div class="row"><label>Diesel</label><input class="invCash" placeholder="Cash " id="DieselCash"><input class="invOnline" placeholder="Online " id="DieselOnline"></div>
  <div class="row"><label>Petrol</label><input class="invCash" placeholder="Cash " id="PetrolCash"><input class="invOnline" placeholder="Online " id="PetrolOnline"></div>
  <div class="row"><label>Egg</label><input class="invCash" placeholder="Cash " id="EggCash"><input class="invOnline" placeholder="Online " id="EggOnline"></div>
  <div class="row"><label>Sachin Salary</label><input class="invCash" placeholder="Cash" id="SachinCash"><input class="invOnline" placeholder="Online " id="SachinOnline"></div>
  <div class="row"><label>Sattu Salary</label><input class="invCash" placeholder="Cash" id="SattuCash"><input class="invOnline" placeholder="Online " id="SattuOnline"></div>
  <div class="row"><label>Other</label><input class="invCash" placeholder="Cash " id="OtherCash"><input class="invOnline" placeholder="Online " id="OtherOnline"></div>

  <p class="total">
    Invest Cash ‚Çπ <span id="invCashTotal">0</span> |
    Invest Online ‚Çπ <span id="invOnlineTotal">0</span>
  </p>
   <p class="total">Total Investment ‚Çπ <span id="InvestmentTotal">0</span></p>
</div>

<!-- PRODUCTION -->
<div class="container">
  <div class="section">---- Production ----</div>
 <div class="row">
  <label>Biryani Made (kg)</label>
  <input id="BiryaniMade" placeholder="0">
</div>

<div class="row">
  <label>Fried Made (kg)</label>
 <input id="FriedMade" placeholder="0">
</div>
<div class="row">
  <label>Remaining Biryani (kg)</label>
 <input id="BiryaniLeft" placeholder="0">
</div>

<div class="row">
  <label>Remaining Fried (kg)</label>
  <input id="FriedLeft" placeholder="0">
</div>
</div>

<!-- SELL -->
<div class="container">
  <div class="section">---- Sell ----</div>
  Sell Cash:<input id="SellCash" placeholder="Cash">
  Sell Online:<input id="SellOnline" placeholder="Online">
  <p class="total">Total Sell ‚Çπ <span id="SellTotal">0</span></p>
</div>

<!-- CURRENT SAVING -->
<div class="container">
  <div class="section">---- Current Saving ----</div>
  Cash ‚Çπ <span id="CurrentCash">0</span><br>
  Online ‚Çπ <span id="CurrentOnline">0</span>
  <p class="total">Total ‚Çπ <span id="CurrentTotal">0</span></p>
</div>

<!-- SAVE BUTTON -->
<div class="sticky-save">
  <button onclick="saveDay()">üíæ Save / Update Day</button>
  <p id="msg"></p>
</div>

<!-- LOADER -->
<div id="popupLoader" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:9999;align-items:center;justify-content:center">
  <div id="popupBox" style="background:#fff;padding:22px 30px;border-radius:10px;text-align:center;min-width:260px">
  
  <div id="popupText" style="font-size:18px;font-weight:bold">
    ‚è≥ Please wait...
  </div>

  <button id="waBtn"
    style="margin-top:18px;display:none;
    background:#25D366;color:#fff;border:none;
    padding:12px 18px;border-radius:10px;
    font-size:16px;font-weight:600;
    cursor:pointer;">
    üì≤ Send message on WhatsApp
  </button>

</div>

</div>

<!-- JS (UNCHANGED) -->
<script>
  let isSaving = false;

let waMessage = "";

let popupLoader = document.getElementById("popupLoader");
let popupText = document.getElementById("popupText");
let waBtn = document.getElementById("waBtn");

let activeRequest = 0;

async function loadLastSavedFromSheet(){
  const box = document.getElementById("lastSavedInfo");

  try{
    const res = await fetch(SCRIPT_URL + "?lastSaved=true");
    const data = await res.json();

    if(data.status === "EMPTY"){
      box.innerText = "No data saved yet";
    }else{
      box.innerHTML = `üìÖ Date: <b>${data.date}</b>`;
    }
  }catch(err){
    box.innerText = "Unable to load date";
  }
}



function showPopup(text){
  popupLoader.style.display = "flex";
  popupText.innerText = text;
  waBtn.style.display = "none";
}

function showWhatsappButton(){
  popupText.innerText = "‚úÖ Saved successfully";
  waBtn.style.display = "inline-block";
}

const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby78QG_u65D6IXG_06aqSyRrVVrAEEGFRj9RxRrCq66nzaNdoSl96xbyxPXzZGeyUXG0g/exec";
  function getWhatsappMessage(date) {
     const totalInvestment = document.getElementById("InvestmentTotal").innerText;
  const totalSell = document.getElementById("SellTotal").innerText;
  const currentTotal = document.getElementById("CurrentTotal").innerText;
    
  return `‚úÖ Daily Hisab Saved
üìÖ Date: ${date}
link : https://saurabh01patil.github.io/daily-hisab/index.html
üí∏ Total Investment: ‚Çπ${totalInvestment}
üí∞ Total Sell: ‚Çπ${totalSell}
üè¶ Current Saving: ‚Çπ${currentTotal}
(sheet me save kr diya h)`;
}
waBtn.onclick = () => {
  //const waUrl = "https://web.whatsapp.com/send?text=" + encodeURIComponent(waMessage);
  const waUrl = "https://wa.me/?text=" + encodeURIComponent(waMessage);
  window.open(waUrl, "_blank");

  popupText.innerText = "‚è≥ Please wait...";
  waBtn.style.display = "none";
  popupLoader.style.display = "none";
};


///let popupLoader=null,activeRequest=0;
  let isDirty = false;

function num(v){return Number(v)||0}
function setInputsDisabled(d){
document.querySelectorAll(".invCash,.invOnline,#SellCash,#SellOnline,#BiryaniMade,#FriedMade,#BiryaniLeft,#FriedLeft")
.forEach(i=>i.disabled=d)}
  document.querySelectorAll("input").forEach(i=>{
  if(i.type !== "date"){
    i.addEventListener("input",()=> isDirty = true);
  }
});


function goToHistory(){
  if(isDirty){
    if(!confirm("Data save nahi hua hai. History par jana hai?")) return;
  }
  window.location.href = "./history.html";
}


function calculate(){
let ic=0,io=0;
document.querySelectorAll(".invCash").forEach(i=>ic+=num(i.value));
document.querySelectorAll(".invOnline").forEach(i=>io+=num(i.value));
invCashTotal.innerText=ic;invOnlineTotal.innerText=io;
SellTotal.innerText=num(SellCash.value)+num(SellOnline.value);
let pc=num(prevCashInput.value),po=num(prevOnlineInput.value);
CurrentCash.innerText=pc+num(SellCash.value)-ic;
CurrentOnline.innerText=po+num(SellOnline.value)-io;
CurrentTotal.innerText=num(CurrentCash.innerText)+num(CurrentOnline.innerText);
prevTotal.innerText=pc+po;
InvestmentTotal.innerText = ic + io;

}

document.querySelectorAll(".invCash,.invOnline,#SellCash,#SellOnline,#BiryaniMade,#FriedMade,#BiryaniLeft,#FriedLeft")
.forEach(i=>i.addEventListener("input",calculate));
  
function clearDayInputs(){
  // üîπ sirf editable inputs clear honge
  document.querySelectorAll("input").forEach(i=>{
    if(
      i.type !== "date" &&        // date input safe
      !i.hasAttribute("readonly") // previous saving safe
    ){
      i.value = "";
    }
  });

  // üîπ totals reset
  invCashTotal.innerText = 0;
  invOnlineTotal.innerText = 0;
  SellTotal.innerText = 0;
  CurrentCash.innerText = 0;
  CurrentOnline.innerText = 0;
  CurrentTotal.innerText = 0;

  // üîπ weekly info reset
  weeklyInfo.innerText = "‚Äì";
}

async function onDateChange(){
if(!date.value)return;
  if(isDirty){
  if(!confirm("Data save nahi hua hai. Continue?")) return;
}
 clearDayInputs(); 

const id=++activeRequest;
setInputsDisabled(true);
if (!isSaving) {
  showPopup("‚è≥ Loading data...");
}

const p=await(await fetch(SCRIPT_URL+"?prevOf="+date.value)).json();
prevCashInput.value=p.currentCash||0;
prevOnlineInput.value=p.currentOnline||0;
const d=await(await fetch(SCRIPT_URL+"?date="+date.value)).json();
if(d.status!=="NOT_FOUND"){Object.keys(d).forEach(k=>{let e=document.getElementById(k);if(e)e.value=d[k]})}
const w=await(await fetch(SCRIPT_URL+"?lastWeekOf="+date.value)).json();
if(w.status!=="NOT_FOUND"){
weeklyInfo.innerHTML=`<b>Last week (${w.date})</b><br><br>
üçö Biryani: ${w.biryaniSold} kg sold<br>
üçó Fried: ${w.friedSold} kg sold<br>
üí∞ Sell ‚Çπ${w.sell}`;
}
if (!isSaving) {
  popupLoader.style.display = "none";
}
setInputsDisabled(false); // üîì UNLOCK inputs
calculate();              // üî¢ recalc previous saving
  isDirty = false; 
}
date.addEventListener("change",onDateChange);

async function saveDay(){
  if(!date.value) return alert("Date select karo");
 isSaving = true; // üîí block date loader
  setInputsDisabled(true);
  showPopup("‚è≥ Saving data...");

  const data={date:date.value};
  document.querySelectorAll("input").forEach(i=>{
    if(i.id && i.type!=="date") data[i.id]=i.value
  });

  data.CurrentCash=CurrentCash.innerText;
  data.CurrentOnline=CurrentOnline.innerText;
  data.CurrentTotal=CurrentTotal.innerText;
  data.SellTotal=SellTotal.innerText;
  data.InvestmentCashTotal = invCashTotal.innerText;
  data.InvestmentOnlineTotal = invOnlineTotal.innerText;
  data.TotalInvestment = Number(invCashTotal.innerText) + Number(invOnlineTotal.innerText);


  await fetch(SCRIPT_URL,{method:"POST",body:JSON.stringify(data)});

  isDirty = false;
setInputsDisabled(false);
calculate();

  // WhatsApp message ready
  waMessage = getWhatsappMessage(date.value);

  // 3 sec delay ke baad button dikhao
  setTimeout(() => {
    showWhatsappButton();
    isSaving = false; // üîì release
  }, 3000);
}
async function loadLastDiesel(){
  try{
    const res = await fetch(SCRIPT_URL + "?lastDiesel=true");
    const data = await res.json();

    const box = document.getElementById("lastDieselBox");

    if(data.status === "NOT_FOUND"){
      box.innerText = "‚õΩ No diesel record found";
      return;
    }

    box.innerText =
      `‚õΩ Last Diesel: ‚Çπ${data.amount} on ${data.date}`;

  }catch(err){
    document.getElementById("lastDieselBox").innerText =
      "‚õΩ Unable to load";
  }
}

window.onload = () => {
  popupLoader = document.getElementById("popupLoader");
  setInputsDisabled(true);
  loadLastSavedFromSheet();
   loadLastDiesel(); 
};



</script>

</body>
</html>





















































